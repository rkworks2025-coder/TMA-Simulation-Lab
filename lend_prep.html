<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="robots" content="noindex"/>
<title>貸出準備 - 入力練習用TMA</title>
<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
<link rel="stylesheet" type="text/css" href="css/reset.css" />
<link rel="stylesheet" type="text/css" href="css/common.css" />
<link rel="stylesheet" type="text/css" href="css/taw0101002.css" />
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<style>
/* iOSの自動ズーム防止用スタイル */
input[type="text"], input[type="number"], input[type="month"], select, textarea { font-size: 16px !important; }
/* チェックボックス強制表示用スタイル */
input[type="checkbox"].check-select { -webkit-appearance: checkbox !important; appearance: checkbox !important; display: inline-block !important; width: 20px !important; height: 20px !important; vertical-align: middle; margin-right: 5px; }
.contents-checkbox-box label { display: inline-flex; align-items: center; }

.main { padding-bottom: 100px; }
.footer-button-triple { display: flex !important; width: 100%; height: 60px; background: #fff; border-top: 1px solid #ccc; }
.footer-button-triple a { flex: 1; display: flex; align-items: center; justify-content: center; text-decoration: none; color: #333; border-right: 1px solid #ccc; font-weight: bold; font-size: 16px; }
.footer-button-triple a:last-child { border-right: none; }
.footer-button-triple a.btn-complete { background-color: #ffd700; color: #000; }
.footer-button-triple a::before { display: none !important; }
.footer-button-triple p { margin: 0; padding: 0; }
.footer { position: fixed; bottom: 0; width: 100%; z-index: 1000; }
/* 未入力時の強調スタイル */
.error-highlight .content-radio-block { border: 1px solid #e60012 !important; background-color: #fce8e8 !important; }
.error-highlight-input { border: 1px solid #e60012 !important; background-color: #fce8e8 !important; }
/* チェックボックス（ルームスイッチ）の強調 */
.contents-checkbox-box.error-highlight { border: 1px solid #e60012 !important; background-color: #fce8e8 !important; padding: 5px; display: inline-block; }
.badge-required { display: inline-block; background-color: #e60012; color: #fff; font-size: 11px; font-weight: bold; padding: 2px 5px; border-radius: 2px; margin-right: 6px; vertical-align: 1px; }

/* エラーモーダル用のスタイル */
.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 9999; align-items: center; justify-content: center; }
.modal-content { background: #fff; width: 90%; max-width: 400px; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); text-align: center; }
.modal-title { font-weight: bold; font-size: 18px; margin-bottom: 15px; color: #333; }
.error-list { text-align: left; margin-bottom: 20px; padding-left: 20px; color: #e60012; font-size: 14px; max-height: 300px; overflow-y: auto; }
.error-list li { margin-bottom: 5px; list-style-type: disc; }
.modal-close-btn { background: #666; color: #fff; border: none; padding: 10px 30px; border-radius: 4px; font-size: 16px; cursor: pointer; }
</style>
</head>
<body>
<header class="new-wb-header"><nav><p class="userName2"><span>【ＴＳ委託】カーケアジャパン (練習用ダミー v3.0)</span></p><br><div class="nav-menu"><div id="nav-drawer"><input id="nav-input" type="checkbox" class="nav-unshown" /><label id="nav-open" for="nav-input"><span></span></label><div id="nav-content"><br><div class="modal-header"><p>メニュー</p></div><br><ul class="modalList"><li><a class="nav-link" href="index.html">トップ</a></li><li><input type="button" value="ログアウト" /></li></ul></div></div></div></nav></header>

<main class="main">
<form method="POST" action="" accept-charset="utf-8" onsubmit="return false;" id="lendPrepForm">
<input type="hidden" id="fromWebFlg" name="fromWebFlg" value="true" />

<div class="maintenance">
<div class="info-area"><h1 class="car-another-title">貸出準備</h1><p class="car-number-text">相模 501 ワ 7725</p></div>

<div class="tab-contents car-another-contents is-inquiry" style="display:block;">

    <h2 class="contents-title">走行距離</h2>
    <div class="contents-block">
        <p class="contents-inner-text">
            <span class="notice-text">ODO（オド）メーター（積算走行距離計）に表示されている距離を入力</span>
        </p>
        <div class="contents-single-input">
            <input type="number" class="single-input required-red" min="0" max="999999" step="1" id="mileage" name="mileage" value="" />km
        </div>
    </div>
    <br>

    <h2 class="contents-title">給油</h2>
    <div class="contents-block">
        <p class="contents-inner-text">
            <span class="notice-text">エンプティランプが点灯している場合は、満タン給油</span>
        </p>
        <p class="category-text category-text--refuel mb5">給油</p>
        <div class="content-radio twoChoices">
            <div class="content-radio-block">
                <input type="radio" class="radio-select" value="1" id="fuelLevelCheck1" name="fuelLevelCheck" />
                <label for="fuelLevelCheck1">実施</label>
            </div>
            <div class="content-radio-block">
                <input type="radio" class="radio-select" value="0" id="fuelLevelCheck2" name="fuelLevelCheck" />
                <label for="fuelLevelCheck2">未実施</label>
            </div>
        </div>
    </div>
    <br>

    <h2 class="contents-title">給油カード</h2>
    <div class="contents-block">
        <p class="contents-inner-text">
            <span>車載されているカード情報（番号・有効期限）が以下入力項目と一致しているか確認</span><br/>
            <span>有効期限切れ・不一致、または新しくカードを車載する場合、OK（交換）を選択してカード情報を入力</span><br/>
            <span>車載可能なカードが無い場合は「NG（稼動停止）」</span>
        </p>
        <div class="content-radio tripleChoices">
            <div class="content-radio-block">
                <input type="radio" class="radio-select fuelCardCondition" value="1" id="fuelCardCondition1" name="fuelCardCondition" />
                <label for="fuelCardCondition1">OK</label>
            </div>
            <div class="content-radio-block">
                <input type="radio" class="radio-select fuelCardCondition" value="2" id="fuelCardCondition2" name="fuelCardCondition"/>
                <label for="fuelCardCondition2">OK（交換）</label>
            </div>
            <div class="content-radio-block">
                <input type="radio" class="radio-select error fuelCardCondition" value="9" id="fuelCardCondition3" name="fuelCardCondition"/>
                <label for="fuelCardCondition3">NG（稼動停止）</label>
            </div>
        </div>
        <p class="category-text mb5">給油カード番号</p>
        <div class="refuel-number">
            <input class="fuelCardNoBox1 disabled" type="number" min="0" max="9999" id="fuelCardNUmber1" name="fuelCardNUmber1" value="2368"/><span>-</span>
            <input class="fuelCardNoBox2 disabled" type="number" min="0" max="9999" id="fuelCardNUmber2" name="fuelCardNUmber2" value="9522"/><span>-</span>
            <input class="fuelCardNoBox3 disabled" type="number" min="0" max="9999" id="fuelCardNUmber3" name="fuelCardNUmber3" value="6070"/>
        </div>
        <br>
        <p class="category-text mb5">給油カードの有効期限</p>
        <div class="expiration-date expiration-date--refuel">
            <div class="select-group">
                <div class="year-select">
                    <select disabled="disabled">
                        <option value="2030">2030年</option>
                    </select>
                </div>
                <div class="month-select">
                    <select disabled="disabled">
                        <option value="7">7月</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <br>

    <h2 class="contents-title">車両確認</h2>
    <div class="contents-block">
        <p class="contents-inner-text">ルームスイッチモードがDOOR設定になっているか確認</p>
        <h3>ルームスイッチ</h3>
        <div class="contents-checkbox-box">
            <label for="roomSwitch1">
                <input type="checkbox" class="check-select" id="roomSwitch1" name="roomSwitch" value="true" />
                <span class="check-title">OK</span>
            </label>
        </div>
    </div>

    <h2 class="contents-title needs">車室シール</h2>
    <div class="contents-block">
        <div class="content-radio tripleChoices">
            <div class="content-radio-block">
                <input type="radio" class="radio-select" value="1" id="interiorSeal1" name="interiorSeal" />
                <label for="interiorSeal1">OK</label>
            </div>
            <div class="content-radio-block">
                <input type="radio" class="radio-select" value="8" id="interiorSeal2" name="interiorSeal" />
                <label for="interiorSeal2">NG</label>
            </div>
            <div class="content-radio-block">
                <input type="radio" class="radio-select" value="0" id="interiorSeal3" name="interiorSeal" />
                <label for="interiorSeal3">対象外</label>
            </div>
        </div>
    </div>
    <br>

    <h2 class="contents-title needs">駐車時確認</h2>
    <div class="contents-block">
        <p class="contents-inner-text">スリットボックスに鍵をセット・バリアポップの設置を確認</p>
        <div class="content-radio twoChoices">
            <div class="content-radio-block">
                <input type="radio" class="radio-select" value="1" id="parkingCheck1" name="parkingCheck" />
                <label for="parkingCheck1">OK</label>
            </div>
            <div class="content-radio-block">
                <input type="radio" class="radio-select" value="0" id="parkingCheck2" name="parkingCheck" />
                <label for="parkingCheck2">対象外</label>
            </div>
        </div>
    </div>

</div>
</div>

<footer class="footer">
<div class="footer-button-triple">
<a href="index.html" class="btn-cancel"><p>中止</p></a>
<a href="javascript:void(0);" onclick="saveDraft();" class="btn-save"><p>一時保存</p></a>
<a href="javascript:void(0);" onclick="completeTask();" class="btn-complete"><p>完了</p></a>
</div>
</footer>
</form>
</main>

<div class="modal-overlay" id="errorModal">
    <div class="modal-content">
        <p class="modal-title">以下の項目が入力されていません</p>
        <ul class="error-list" id="errorList"></ul>
        <button class="modal-close-btn" onclick="closeErrorModal()">閉じる</button>
    </div>
</div>

<script type="text/javascript">
$(function () {
  // 保存データを復元
  loadFormData();

  // ラジオボタン・チェックボックス・テキストの変更処理
  $(document).on('change input', 'input', function() {
    updateHighlights();
  });

  // 未選択・未入力の必須項目をピンク色にするリアルタイムバリデーション
  function updateHighlights() {
    // ラジオボタン判定
    $('.content-radio').each(function() {
      var $radios = $(this).find('input[type="radio"]');
      if ($radios.length > 0) {
        var radioName = $radios.first().attr('name');
        if ($('input[name="' + radioName + '"]:checked').length === 0) {
          $(this).addClass('error-highlight');
        } else {
          $(this).removeClass('error-highlight');
        }
      }
    });
    
    // チェックボックス判定（ルームスイッチ）
    if (!$('#roomSwitch1').is(':checked')) {
        $('.contents-checkbox-box').addClass('error-highlight');
    } else {
        $('.contents-checkbox-box').removeClass('error-highlight');
    }

    // テキスト・数値の必須入力枠判定
    $('.required-red').each(function() {
      if ($(this).val() === '') {
        $(this).addClass('error-highlight-input');
      } else {
        $(this).removeClass('error-highlight-input');
      }
    });
  }

  // 初回読み込み時にピンク色にする
  updateHighlights();
});

// フォームデータを保存する関数
function saveFormData() {
    const formData = {};
    $('input, select, textarea').each(function() {
        const type = $(this).attr('type');
        const name = $(this).attr('name');
        if (!name) return;

        if (type === 'radio') {
            if ($(this).is(':checked')) {
                formData[name] = $(this).val();
            }
        } else if (type === 'checkbox') {
            if ($(this).is(':checked')) {
                formData[name] = $(this).val(); 
            }
        } else {
            formData[name] = $(this).val();
        }
    });
    sessionStorage.setItem('lendPrepCheckFormData', JSON.stringify(formData));
}

// フォームデータを読み込む関数
function loadFormData() {
    const savedData = sessionStorage.getItem('lendPrepCheckFormData');
    if (savedData) {
        const formData = JSON.parse(savedData);
        for (const name in formData) {
            const val = formData[name];
            const $el = $('[name="' + name + '"]');
            
            if ($el.attr('type') === 'radio') {
                $el.filter('[value="' + val + '"]').prop('checked', true);
            } else if ($el.attr('type') === 'checkbox') {
                $el.filter('[value="' + val + '"]').prop('checked', true);
            } else {
                $el.val(val);
            }
        }
    }
}

// 一時保存ボタンの処理
function saveDraft() {
  saveFormData();
  sessionStorage.setItem('lendPrepCheckDraft', 'true');
  sessionStorage.removeItem('lendPrepCheckCompleted');
  window.location.href = 'index.html';
}

// 必須項目のチェックを行い、未入力があればリストを返す
function getMissingItems() {
    var missingItems = [];

    // ラジオボタンのチェック
    $('.content-radio').each(function() {
        var $radios = $(this).find('input[type="radio"]');
        if ($radios.length > 0) {
            var radioName = $radios.first().attr('name');
            if ($('input[name="' + radioName + '"]:checked').length === 0) {
                var label = $(this).closest('.contents-block').prev('.contents-title').text().trim();
                if (!label) label = $(this).parent().prev('.contents-title').text().trim(); // ネスト対応
                if (label && missingItems.indexOf(label) === -1) missingItems.push(label);
            }
        }
    });

    // チェックボックス（ルームスイッチ）
    if (!$('#roomSwitch1').is(':checked')) {
        missingItems.push("車両確認（ルームスイッチ）");
    }

    // テキスト・数値（走行距離）
    $('.required-red').each(function() {
        if ($(this).val() === '') {
            var label = $(this).closest('.contents-block').prev('.contents-title').text().trim();
            if (label && missingItems.indexOf(label) === -1) missingItems.push(label);
        }
    });

    return missingItems;
}

// 完了ボタンの処理
function completeTask() {
  var missingItems = getMissingItems();

  if (missingItems.length > 0) {
      var listHtml = '';
      for (var i = 0; i < missingItems.length; i++) {
          listHtml += '<li>' + missingItems[i] + '</li>';
      }
      $('#errorList').html(listHtml);
      $('#errorModal').css('display', 'flex');
  } else {
      sessionStorage.setItem('lendPrepCheckCompleted', 'true');
      sessionStorage.removeItem('lendPrepCheckDraft');
      window.location.href = 'index.html';
  }
}

function closeErrorModal() {
    $('#errorModal').hide();
}
</script>
</body>
</html>

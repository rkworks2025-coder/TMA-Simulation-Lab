<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="robots" content="noindex"/>
<title>トップ - 入力練習用TMA</title>
<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
<link rel="stylesheet" type="text/css" href="css/reset.css" />
<link rel="stylesheet" type="text/css" href="css/common.css" />
<link rel="stylesheet" type="text/css" href="css/taw0101002.css" />
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<style>
/* トップ画面専用のボタンスタイル */
.top-main { padding: 20px; background-color: #f5f5f5; min-height: 100vh; }
.car-info-box { background: #fff; padding: 15px; border: 1px solid #ccc; border-radius: 5px; margin-bottom: 20px; font-weight: bold; text-align: center; }
.status-msg-box { text-align: center; margin-bottom: 20px; font-size: 16px; font-weight: bold; color: #e60012; }
.btn-start { display: block; width: 100%; padding: 15px; background-color: #e60012; color: #fff; text-align: center; text-decoration: none; font-size: 18px; font-weight: bold; border-radius: 5px; margin-bottom: 30px; }
.menu-list { display: flex; flex-direction: column; gap: 15px; }
.menu-item { display: flex; justify-content: space-between; align-items: center; background: #fff; border: 1px solid #ccc; padding: 15px 20px; text-decoration: none; color: #333; font-size: 16px; font-weight: bold; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
.disabled-btn { background: #e0e0e0; color: #999; pointer-events: none; border-color: #bbb; box-shadow: none; }

/* ステータスバッジのスタイル */
.status-badge { font-size: 12px; padding: 4px 12px; border-radius: 3px; font-weight: normal; }
.badge-none { background: #ccc; color: #fff; }
.badge-yet { background: #999; color: #fff; }
.badge-temp { background: #ff9800; color: #fff; } /* 一時保存（オレンジ） */
.badge-done { background: #e60012; color: #fff; } /* 完了（赤） */
</style>
</head>
<body>
<header class="new-wb-header">
    <nav>
        <p class="userName2"><span>【ＴＳ委託】カーケアジャパン (練習用ダミー v3.1)</span></p>
        <br>
        <div class="nav-menu">
            <div id="nav-drawer">
                <input id="nav-input" type="checkbox" class="nav-unshown" />
                <label id="nav-open" for="nav-input"><span></span></label>
                <div id="nav-content">
                    <br><div class="modal-header"><p>メニュー</p></div><br>
                    <ul class="modalList">
                        <li><input type="button" value="ログアウト" /></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
</header>

<main class="top-main">
    <div class="car-info-box">
        車両番号：相模 501 ワ 7725
    </div>

    <div id="status-msg" class="status-msg-box">点検を開始してください</div>

    <a href="#" id="btn-start-inspection" class="btn-start">点検開始</a>

    <div class="menu-list">
        <a href="daily_check.html" id="btn-daily-check" class="menu-item disabled-btn">
            <span>日常点検</span>
            <span id="badge-daily-check" class="status-badge badge-none">-</span>
        </a>
        <a href="#" class="menu-item disabled-btn">
            <span>車内清掃</span>
            <span class="status-badge badge-none">-</span>
        </a>
    </div>
</main>

<script type="text/javascript">
$(function () {
    // 1. セッションストレージから状態を読み取り
    var isStarted = sessionStorage.getItem('inspectionStarted');
    var dailyStatus = sessionStorage.getItem('dailyCheckStatus'); // 'temp' or 'done'
    var dailyCompleted = sessionStorage.getItem('dailyCheckCompleted'); // v3.0までの完了互換用

    var $startBtn = $('#btn-start-inspection');
    var $dailyBadge = $('#badge-daily-check');
    var $statusMsg = $('#status-msg');

    // 2. 点検開始ボタンの処理（クリックでフラグを立ててリロード）
    $startBtn.on('click', function(e) {
        e.preventDefault();
        sessionStorage.setItem('inspectionStarted', 'true');
        location.reload(); 
    });

    // 3. 画面描画時のステータス反映ロジック
    if (isStarted === 'true') {
        // --- 点検開始後 ---
        $startBtn.hide(); 
        $statusMsg.text('作業中').css('color', '#333');
        
        // 下の点検ボタンを有効化
        $('.menu-item').removeClass('disabled-btn');
        $('#btn-daily-check').attr('href', 'daily_check.html'); // 日常点検へのリンク有効化

        // 日常点検の一時保存・完了ステータスの判定とバッジ切り替え
        if (dailyCompleted === 'true' || dailyStatus === 'done') {
            $dailyBadge.text('完了').removeClass().addClass('status-badge badge-done');
        } else if (dailyStatus === 'temp') {
            $dailyBadge.text('一時保存').removeClass().addClass('status-badge badge-temp');
        } else {
            $dailyBadge.text('未実施').removeClass().addClass('status-badge badge-yet');
        }
    } else {
        // --- 点検開始前（初期状態） ---
        $startBtn.show();
        $statusMsg.text('点検を開始してください');
        $('.menu-item').addClass('disabled-btn').removeAttr('href');
        $('.status-badge').text('-').removeClass().addClass('status-badge badge-none');
    }
});
</script>
</body>
</html>
